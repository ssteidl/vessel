# -*- mode: tcl; indent-tabs-mode: nil; tab-width: 4; -*-

package require vessel::env
package require logger
package require vessel::network
package require tcltest

namespace eval network::test {
	namespace import ::tcltest::*

	test {create-bridge} {Test that we can create a bridge without an inet interface} -setup {
	    
	    #Delete the vessel bridge if it exists
	    catch {exec ifconfig vessel destroy}
	} -body {
	 
	    vessel::network::bridge::create_bridge {}
	} -cleanup {
	  catch {exec ifconfig vessel destroy}  
	} -result true
	
	test {create-bridge-internet} {Test that we can create a bridge and attach a nic} -setup {
	 
	    catch {exec ifconfig vessel destroy}
	} -body {
	     vessel::network::bridge::create_bridge {em0}
	     
	     set bridge_outut [exec ifconfig vessel]
	    
	} -cleanup {
	    catch {ifconfig vessel destroy}
	} -match glob -result "*member: em0*"
	
	test {router-exists-1} {Check if a router exists} -body {
	    vessel::network::router::router_image_exists?
	} -result 1
	
	test {router-template-1} {Verify the router template is properly rendered} -body {
	    vessel::network::router::get_image_template
	} -result {
FROM FreeBSD:12.3-RELEASE

RUN env ASSUME_ALWAYS_YES=yes pkg update
RUN env pkg install dnsmasq}
	
	cleanupTests
}